<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Brain Tree Nutrition - Business Platform</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .tab-button.active { @apply bg-gradient-to-r from-blue-600 to-blue-700 text-white shadow-lg; }
        .tab-button:not(.active) { @apply text-gray-600 hover:bg-gray-50 hover:text-blue-600 transition-all duration-200; }
        .tab-content { @apply hidden; }
        .tab-content.active { @apply block animate-fadeIn; }
        .btn-primary { @apply px-6 py-3 bg-gradient-to-r from-blue-600 to-blue-700 text-white rounded-xl hover:from-blue-700 hover:to-blue-800 transition-all duration-200 shadow-lg hover:shadow-xl transform hover:-translate-y-0.5; }
        .card { @apply bg-white rounded-2xl shadow-lg border border-gray-100 hover:shadow-xl transition-all duration-300; }
        .stat-card { @apply bg-gradient-to-br from-white to-gray-50 rounded-2xl shadow-lg border border-gray-100 p-6 hover:shadow-xl transition-all duration-300; }
        .empty-state { @apply text-center py-12 text-gray-500; }
        .empty-state-icon { @apply mx-auto mb-4 text-gray-300 text-6xl; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fadeIn { animation: fadeIn 0.3s ease-out; }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Login Screen -->
    <div id="loginScreen" class="min-h-screen flex items-center justify-center bg-gray-50">
        <div class="max-w-md w-full space-y-8">
            <div class="text-center">
                <h2 class="text-3xl font-bold text-gray-900">Brain Tree Nutrition</h2>
                <p class="mt-2 text-gray-600">Business Management Platform</p>
            </div>
            <form id="loginForm" class="mt-8 space-y-6">
                <div>
                    <input id="email" name="email" type="email" required class="w-full px-3 py-2 border border-gray-300 rounded-md" placeholder="Email address">
                </div>
                <div>
                    <input id="password" name="password" type="password" required class="w-full px-3 py-2 border border-gray-300 rounded-md" placeholder="Password">
                </div>
                <div>
                    <button type="submit" class="w-full btn-primary">Sign In</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Main App -->
    <div id="mainApp" class="hidden">
        <!-- Header -->
        <header class="bg-white border-b border-gray-200 px-8 py-6 shadow-sm">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <div class="w-10 h-10 bg-gradient-to-r from-blue-600 to-blue-700 rounded-xl flex items-center justify-center">
                        <span class="text-white font-bold text-lg">BT</span>
                    </div>
                    <div>
                        <h1 class="text-2xl font-bold text-gray-900">Brain Tree Nutrition</h1>
                        <p class="text-sm text-gray-500">Business Management Platform</p>
                    </div>
                </div>
                <button onclick="logout()" class="btn-primary">Logout</button>
            </div>
        </header>

        <!-- Navigation -->
        <nav class="bg-white border-b border-gray-200 px-8 py-4">
            <div class="flex space-x-1">
                <button class="tab-button active px-6 py-3 rounded-xl font-medium" onclick="showTab('dashboard', this)">üìä Dashboard</button>
                <button class="tab-button px-6 py-3 rounded-xl font-medium" onclick="showTab('products', this)">üì¶ Products</button>
                <button class="tab-button px-6 py-3 rounded-xl font-medium" onclick="showTab('customers', this)">üë• Customers</button>
                <button class="tab-button px-6 py-3 rounded-xl font-medium" onclick="showTab('orders', this)">üõí Orders</button>
                <button class="tab-button px-6 py-3 rounded-xl font-medium" onclick="showTab('integrations', this)">üîó Integrations</button>
            </div>
        </nav>

        <!-- Content -->
        <main class="p-8">
            <!-- Dashboard Tab -->
            <div id="dashboard" class="tab-content active">
                <div class="mb-8">
                    <h2 class="text-3xl font-bold text-gray-900 mb-2">Welcome to Your Business Dashboard</h2>
                    <p class="text-gray-600">Manage your products, customers, and sales in one place</p>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <div class="stat-card">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-500 text-sm font-medium">Total Revenue</p>
                                <p class="text-3xl font-bold text-gray-900" id="totalRevenue">$0</p>
                            </div>
                            <div class="w-12 h-12 bg-green-100 rounded-xl flex items-center justify-center">
                                <span class="text-2xl">üí∞</span>
                            </div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-500 text-sm font-medium">Total Orders</p>
                                <p class="text-3xl font-bold text-gray-900" id="totalOrders">0</p>
                            </div>
                            <div class="w-12 h-12 bg-blue-100 rounded-xl flex items-center justify-center">
                                <span class="text-2xl">üì¶</span>
                            </div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-500 text-sm font-medium">Customers</p>
                                <p class="text-3xl font-bold text-gray-900" id="totalCustomers">0</p>
                            </div>
                            <div class="w-12 h-12 bg-purple-100 rounded-xl flex items-center justify-center">
                                <span class="text-2xl">üë•</span>
                            </div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-500 text-sm font-medium">Products</p>
                                <p class="text-3xl font-bold text-gray-900" id="totalProducts">0</p>
                            </div>
                            <div class="w-12 h-12 bg-orange-100 rounded-xl flex items-center justify-center">
                                <span class="text-2xl">üè∑Ô∏è</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div class="card p-6">
                        <h3 class="text-xl font-semibold mb-6 text-gray-900">Recent Orders</h3>
                        <div id="recentOrders" class="empty-state">
                            <div class="empty-state-icon">üì¶</div>
                            <p class="text-lg font-medium">No orders yet</p>
                            <p class="text-sm">Start by adding your first order</p>
                        </div>
                    </div>
                    <div class="card p-6">
                        <h3 class="text-xl font-semibold mb-6 text-gray-900">Top Products</h3>
                        <div id="topProducts" class="empty-state">
                            <div class="empty-state-icon">üèÜ</div>
                            <p class="text-lg font-medium">No products yet</p>
                            <p class="text-sm">Add products to see analytics</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Products Tab -->
            <div id="products" class="tab-content">
                <div class="mb-8">
                    <div class="flex justify-between items-center mb-6">
                        <div>
                            <h2 class="text-3xl font-bold text-gray-900">Products</h2>
                            <p class="text-gray-600">Manage your inventory and product catalog</p>
                        </div>
                        <button onclick="showAddProductModal()" class="btn-primary">+ Add Product</button>
                    </div>
                </div>
                <div class="card">
                    <div class="p-6">
                        <div id="productsList" class="empty-state">
                            <div class="empty-state-icon">üì¶</div>
                            <p class="text-lg font-medium">No products yet</p>
                            <p class="text-sm">Add your first product to get started</p>
                            <button onclick="showAddProductModal()" class="btn-primary mt-4">Add Product</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Customers Tab -->
            <div id="customers" class="tab-content">
                <div class="mb-8">
                    <div class="flex justify-between items-center mb-6">
                        <div>
                            <h2 class="text-3xl font-bold text-gray-900">Customers</h2>
                            <p class="text-gray-600">Manage your customer database and relationships</p>
                        </div>
                        <button onclick="showAddCustomerModal()" class="btn-primary">+ Add Customer</button>
                    </div>
                </div>
                <div class="card">
                    <div class="p-6">
                        <div id="customersList" class="empty-state">
                            <div class="empty-state-icon">üë•</div>
                            <p class="text-lg font-medium">No customers yet</p>
                            <p class="text-sm">Add your first customer to get started</p>
                            <button onclick="showAddCustomerModal()" class="btn-primary mt-4">Add Customer</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Orders Tab -->
            <div id="orders" class="tab-content">
                <div class="mb-8">
                    <div class="flex justify-between items-center mb-6">
                        <div>
                            <h2 class="text-3xl font-bold text-gray-900">Orders</h2>
                            <p class="text-gray-600">Track sales and manage order fulfillment</p>
                        </div>
                        <button onclick="showAddOrderModal()" class="btn-primary">+ Add Order</button>
                    </div>
                </div>
                <div class="card">
                    <div class="p-6">
                        <div id="ordersList" class="empty-state">
                            <div class="empty-state-icon">üõí</div>
                            <p class="text-lg font-medium">No orders yet</p>
                            <p class="text-sm">Add your first order to get started</p>
                            <button onclick="showAddOrderModal()" class="btn-primary mt-4">Add Order</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Integrations Tab -->
            <div id="integrations" class="tab-content">
                <div class="mb-8">
                    <div class="flex justify-between items-center mb-6">
                        <div>
                            <h2 class="text-3xl font-bold text-gray-900">Integrations</h2>
                            <p class="text-gray-600">Connect with external platforms and services</p>
                        </div>
                        <button onclick="showAddIntegrationModal()" class="btn-primary">+ Add Integration</button>
                    </div>
                </div>
                <div class="card">
                    <div class="p-6">
                        <div id="integrationsList" class="empty-state">
                            <div class="empty-state-icon">üîó</div>
                            <p class="text-lg font-medium">No integrations yet</p>
                            <p class="text-sm">Connect with Shopify, Stripe, and more</p>
                            <button onclick="showAddIntegrationModal()" class="btn-primary mt-4">Add Integration</button>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        let authToken = localStorage.getItem('authToken');
        let currentUser = JSON.parse(localStorage.getItem('user'));

        // API Functions
        async function apiCall(endpoint, options = {}) {
            const baseUrl = window.location.origin;
            const url = `${baseUrl}/api${endpoint}`;
            
            const config = {
                headers: {
                    'Content-Type': 'application/json',
                    ...(authToken && { 'Authorization': `Bearer ${authToken}` })
                },
                ...options
            };

            try {
                const response = await fetch(url, config);
                if (!response.ok) {
                    if (response.status === 401) {
                        logout();
                        return;
                    }
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return await response.json();
            } catch (error) {
                console.error('API Error:', error);
                throw error;
            }
        }

        // Authentication
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;

            try {
                const response = await apiCall('/auth/login', {
                    method: 'POST',
                    body: JSON.stringify({ email, password })
                });

                authToken = response.token;
                currentUser = response.user;
                localStorage.setItem('authToken', authToken);
                localStorage.setItem('user', JSON.stringify(currentUser));

                showMainApp();
                loadDashboard();
            } catch (error) {
                alert('Login failed: ' + error.message);
            }
        });

        function logout() {
            localStorage.removeItem('authToken');
            localStorage.removeItem('user');
            authToken = null;
            currentUser = null;
            showLoginScreen();
        }

        function showLoginScreen() {
            document.getElementById('loginScreen').classList.remove('hidden');
            document.getElementById('mainApp').classList.add('hidden');
        }

        function showMainApp() {
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('mainApp').classList.remove('hidden');
        }

        // Tab Navigation
        function showTab(tabName, clickedElement) {
            try {
                console.log('Tab clicked:', tabName);
                
                // Remove active class from all tabs and content
                document.querySelectorAll('.tab-content').forEach(tab => {
                    tab.classList.remove('active');
                });
                
                document.querySelectorAll('.tab-button').forEach(btn => {
                    btn.classList.remove('active');
                });
                
                // Add active class to selected tab and content
                const targetTab = document.getElementById(tabName);
                if (targetTab) {
                    targetTab.classList.add('active');
                    console.log('‚úÖ Tab switched to:', tabName);
                } else {
                    console.error('‚ùå Tab not found:', tabName);
                    return;
                }
                
                if (clickedElement) {
                    clickedElement.classList.add('active');
                }

                // Load content based on tab
                switch(tabName) {
                    case 'dashboard':
                        loadDashboard();
                        break;
                    case 'products':
                        loadProducts();
                        break;
                    case 'customers':
                        loadCustomers();
                        break;
                    case 'orders':
                        loadOrders();
                        break;
                    case 'integrations':
                        loadIntegrations();
                        break;
                    default:
                        console.error('‚ùå Unknown tab:', tabName);
                }
            } catch (error) {
                console.error('‚ùå Error switching tabs:', error);
            }
        }

        // Dashboard
        async function loadDashboard() {
            try {
                const data = await apiCall('/dashboard');
                
                document.getElementById('totalRevenue').textContent = `$${data.stats.revenue.toLocaleString()}`;
                document.getElementById('totalOrders').textContent = data.stats.orders;
                document.getElementById('totalCustomers').textContent = data.stats.customers;
                document.getElementById('totalProducts').textContent = data.stats.products;

                // Recent Orders
                if (data.recentOrders && data.recentOrders.length > 0) {
                    const recentOrdersHtml = data.recentOrders.map(order => `
                        <div class="border-b border-gray-100 py-4 hover:bg-gray-50 rounded-lg px-3 transition-colors">
                            <div class="flex justify-between items-center">
                                <div>
                                    <div class="font-semibold text-gray-900">${order.customerId?.name || 'Unknown Customer'}</div>
                                    <div class="text-sm text-gray-500">${new Date(order.createdAt).toLocaleDateString()}</div>
                                </div>
                                <div class="text-right">
                                    <div class="font-bold text-green-600">$${order.total}</div>
                                    <div class="text-xs text-gray-500">${order.status}</div>
                                </div>
                            </div>
                        </div>
                    `).join('');
                    document.getElementById('recentOrders').innerHTML = recentOrdersHtml;
                } else {
                    document.getElementById('recentOrders').innerHTML = `
                        <div class="empty-state">
                            <div class="empty-state-icon">üì¶</div>
                            <p class="text-lg font-medium">No orders yet</p>
                            <p class="text-sm">Start by adding your first order</p>
                        </div>
                    `;
                }

                // Top Products
                if (data.topProducts && data.topProducts.length > 0) {
                    const topProductsHtml = data.topProducts.map(item => `
                        <div class="border-b border-gray-100 py-4 hover:bg-gray-50 rounded-lg px-3 transition-colors">
                            <div class="flex justify-between items-center">
                                <div>
                                    <div class="font-semibold text-gray-900">${item.product[0]?.name || 'Unknown Product'}</div>
                                    <div class="text-sm text-gray-500">SKU: ${item.product[0]?.sku || 'N/A'}</div>
                                </div>
                                <div class="text-right">
                                    <div class="font-bold text-blue-600">${item.totalSold} sold</div>
                                    <div class="text-xs text-gray-500">units</div>
                                </div>
                            </div>
                        </div>
                    `).join('');
                    document.getElementById('topProducts').innerHTML = topProductsHtml;
                } else {
                    document.getElementById('topProducts').innerHTML = `
                        <div class="empty-state">
                            <div class="empty-state-icon">üèÜ</div>
                            <p class="text-lg font-medium">No products yet</p>
                            <p class="text-sm">Add products to see analytics</p>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Error loading dashboard:', error);
            }
        }

        // Products
        async function loadProducts() {
            try {
                const products = await apiCall('/products');
                if (products && products.length > 0) {
                    const productsHtml = products.map(product => `
                        <div class="border-b border-gray-100 py-6 hover:bg-gray-50 rounded-xl px-4 transition-all duration-200">
                            <div class="flex justify-between items-start">
                                <div class="flex-1">
                                    <div class="flex items-center space-x-3 mb-2">
                                        <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center">
                                            <span class="text-blue-600 font-bold">üì¶</span>
                                        </div>
                                        <div>
                                            <h3 class="font-bold text-lg text-gray-900">${product.name}</h3>
                                            <p class="text-sm text-gray-500">${product.category || 'Uncategorized'}</p>
                                        </div>
                                    </div>
                                    <p class="text-gray-600 mb-2">${product.description || 'No description'}</p>
                                    <div class="flex items-center space-x-4 text-sm text-gray-500">
                                        <span>SKU: ${product.sku}</span>
                                        <span>Stock: ${product.stock}</span>
                                    </div>
                                </div>
                                <div class="text-right">
                                    <div class="text-2xl font-bold text-green-600">$${product.price}</div>
                                    <div class="text-sm text-gray-500">per unit</div>
                                </div>
                            </div>
                        </div>
                    `).join('');
                    document.getElementById('productsList').innerHTML = productsHtml;
                } else {
                    document.getElementById('productsList').innerHTML = `
                        <div class="empty-state">
                            <div class="empty-state-icon">üì¶</div>
                            <p class="text-lg font-medium">No products yet</p>
                            <p class="text-sm">Add your first product to get started</p>
                            <button onclick="showAddProductModal()" class="btn-primary mt-4">Add Product</button>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Error loading products:', error);
            }
        }

        // Customers
        async function loadCustomers() {
            try {
                const customers = await apiCall('/customers');
                if (customers && customers.length > 0) {
                    const customersHtml = customers.map(customer => `
                        <div class="border-b border-gray-100 py-6 hover:bg-gray-50 rounded-xl px-4 transition-all duration-200">
                            <div class="flex justify-between items-start">
                                <div class="flex-1">
                                    <div class="flex items-center space-x-3 mb-2">
                                        <div class="w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center">
                                            <span class="text-purple-600 font-bold">üë§</span>
                                        </div>
                                        <div>
                                            <h3 class="font-bold text-lg text-gray-900">${customer.name}</h3>
                                            <p class="text-sm text-gray-500">${customer.email}</p>
                                        </div>
                                    </div>
                                    <div class="flex items-center space-x-4 text-sm text-gray-500 mb-2">
                                        <span>üìû ${customer.phone || 'No phone'}</span>
                                        <span>üìß ${customer.email}</span>
                                    </div>
                                    <div class="flex items-center space-x-4 text-sm">
                                        <span class="px-2 py-1 bg-green-100 text-green-800 rounded-full">${customer.status || 'active'}</span>
                                    </div>
                                </div>
                                <div class="text-right">
                                    <div class="text-2xl font-bold text-green-600">$${customer.totalSpent || 0}</div>
                                    <div class="text-sm text-gray-500">${customer.orders || 0} orders</div>
                                </div>
                            </div>
                        </div>
                    `).join('');
                    document.getElementById('customersList').innerHTML = customersHtml;
                } else {
                    document.getElementById('customersList').innerHTML = `
                        <div class="empty-state">
                            <div class="empty-state-icon">üë•</div>
                            <p class="text-lg font-medium">No customers yet</p>
                            <p class="text-sm">Add your first customer to get started</p>
                            <button onclick="showAddCustomerModal()" class="btn-primary mt-4">Add Customer</button>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Error loading customers:', error);
            }
        }

        // Orders
        async function loadOrders() {
            try {
                const orders = await apiCall('/orders');
                if (orders && orders.length > 0) {
                    const ordersHtml = orders.map(order => `
                        <div class="border-b border-gray-100 py-6 hover:bg-gray-50 rounded-xl px-4 transition-all duration-200">
                            <div class="flex justify-between items-start">
                                <div class="flex-1">
                                    <div class="flex items-center space-x-3 mb-2">
                                        <div class="w-10 h-10 bg-orange-100 rounded-lg flex items-center justify-center">
                                            <span class="text-orange-600 font-bold">üõí</span>
                                        </div>
                                        <div>
                                            <h3 class="font-bold text-lg text-gray-900">Order #${order._id.slice(-6)}</h3>
                                            <p class="text-sm text-gray-500">${order.customerId?.name || 'Unknown Customer'}</p>
                                        </div>
                                    </div>
                                    <div class="flex items-center space-x-4 text-sm text-gray-500 mb-2">
                                        <span>üìÖ ${new Date(order.createdAt).toLocaleDateString()}</span>
                                        <span>üí≥ ${order.paymentMethod || 'Unknown'}</span>
                                    </div>
                                    <div class="flex items-center space-x-4 text-sm">
                                        <span class="px-2 py-1 ${order.status === 'completed' ? 'bg-green-100 text-green-800' : order.status === 'pending' ? 'bg-yellow-100 text-yellow-800' : 'bg-red-100 text-red-800'} rounded-full">${order.status}</span>
                                    </div>
                                </div>
                                <div class="text-right">
                                    <div class="text-2xl font-bold text-green-600">$${order.total}</div>
                                    <div class="text-sm text-gray-500">total</div>
                                </div>
                            </div>
                        </div>
                    `).join('');
                    document.getElementById('ordersList').innerHTML = ordersHtml;
                } else {
                    document.getElementById('ordersList').innerHTML = `
                        <div class="empty-state">
                            <div class="empty-state-icon">üõí</div>
                            <p class="text-lg font-medium">No orders yet</p>
                            <p class="text-sm">Add your first order to get started</p>
                            <button onclick="showAddOrderModal()" class="btn-primary mt-4">Add Order</button>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Error loading orders:', error);
            }
        }

        // Integrations
        async function loadIntegrations() {
            try {
                const integrations = await apiCall('/integrations');
                if (integrations && integrations.length > 0) {
                    const integrationsHtml = integrations.map(integration => `
                        <div class="border-b border-gray-100 py-6 hover:bg-gray-50 rounded-xl px-4 transition-all duration-200">
                            <div class="flex justify-between items-start">
                                <div class="flex-1">
                                    <div class="flex items-center space-x-3 mb-2">
                                        <div class="w-10 h-10 bg-indigo-100 rounded-lg flex items-center justify-center">
                                            <span class="text-indigo-600 font-bold">üîó</span>
                                        </div>
                                        <div>
                                            <h3 class="font-bold text-lg text-gray-900">${integration.platform}</h3>
                                            <p class="text-sm text-gray-500">${integration.storeUrl || 'No URL configured'}</p>
                                        </div>
                                    </div>
                                    <div class="flex items-center space-x-4 text-sm text-gray-500 mb-2">
                                        <span>üîÑ Last sync: ${integration.lastSync ? new Date(integration.lastSync).toLocaleDateString() : 'Never'}</span>
                                        <span>üîë API: ${integration.apiKey ? 'Configured' : 'Not configured'}</span>
                                    </div>
                                    <div class="flex items-center space-x-4 text-sm">
                                        <span class="px-2 py-1 ${integration.isActive ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-800'} rounded-full">${integration.isActive ? 'Active' : 'Inactive'}</span>
                                    </div>
                                </div>
                                <div class="text-right">
                                    <div class="text-sm text-gray-500">Integration</div>
                                    <div class="text-xs text-gray-400">${integration.platform}</div>
                                </div>
                            </div>
                        </div>
                    `).join('');
                    document.getElementById('integrationsList').innerHTML = integrationsHtml;
                } else {
                    document.getElementById('integrationsList').innerHTML = `
                        <div class="empty-state">
                            <div class="empty-state-icon">üîó</div>
                            <p class="text-lg font-medium">No integrations yet</p>
                            <p class="text-sm">Connect with Shopify, Stripe, and more</p>
                            <button onclick="showAddIntegrationModal()" class="btn-primary mt-4">Add Integration</button>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Error loading integrations:', error);
            }
        }

        // Modal Functions
        function showAddProductModal() {
            const modal = `
                <div id="productModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                    <div class="bg-white rounded-lg p-6 w-full max-w-md">
                        <h3 class="text-lg font-semibold mb-4">Add New Product</h3>
                        <form id="addProductForm" class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Product Name</label>
                                <input type="text" name="name" required class="w-full px-3 py-2 border border-gray-300 rounded-md">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Description</label>
                                <textarea name="description" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-md"></textarea>
                            </div>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Price ($)</label>
                                    <input type="number" name="price" step="0.01" required class="w-full px-3 py-2 border border-gray-300 rounded-md">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Stock</label>
                                    <input type="number" name="stock" required class="w-full px-3 py-2 border border-gray-300 rounded-md">
                                </div>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700">SKU</label>
                                <input type="text" name="sku" required class="w-full px-3 py-2 border border-gray-300 rounded-md">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Category</label>
                                <input type="text" name="category" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                            </div>
                            <div class="flex gap-2 pt-4">
                                <button type="submit" class="flex-1 btn-primary">Add Product</button>
                                <button type="button" onclick="closeModal('productModal')" class="flex-1 px-4 py-2 border border-gray-300 rounded-lg">Cancel</button>
                            </div>
                        </form>
                    </div>
                </div>
            `;
            document.body.insertAdjacentHTML('beforeend', modal);
            
            document.getElementById('addProductForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                const formData = new FormData(e.target);
                const productData = Object.fromEntries(formData.entries());
                productData.price = parseFloat(productData.price);
                productData.stock = parseInt(productData.stock);
                
                try {
                    await apiCall('/products', {
                        method: 'POST',
                        body: JSON.stringify(productData)
                    });
                    closeModal('productModal');
                    loadProducts();
                    alert('Product added successfully!');
                } catch (error) {
                    alert('Error adding product: ' + error.message);
                }
            });
        }

        function showAddCustomerModal() {
            const modal = `
                <div id="customerModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                    <div class="bg-white rounded-lg p-6 w-full max-w-md">
                        <h3 class="text-lg font-semibold mb-4">Add New Customer</h3>
                        <form id="addCustomerForm" class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Name</label>
                                <input type="text" name="name" required class="w-full px-3 py-2 border border-gray-300 rounded-md">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Email</label>
                                <input type="email" name="email" required class="w-full px-3 py-2 border border-gray-300 rounded-md">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Phone</label>
                                <input type="tel" name="phone" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                            </div>
                            <div class="flex gap-2 pt-4">
                                <button type="submit" class="flex-1 btn-primary">Add Customer</button>
                                <button type="button" onclick="closeModal('customerModal')" class="flex-1 px-4 py-2 border border-gray-300 rounded-lg">Cancel</button>
                            </div>
                        </form>
                    </div>
                </div>
            `;
            document.body.insertAdjacentHTML('beforeend', modal);
            
            document.getElementById('addCustomerForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                const formData = new FormData(e.target);
                const customerData = Object.fromEntries(formData.entries());
                
                try {
                    await apiCall('/customers', {
                        method: 'POST',
                        body: JSON.stringify(customerData)
                    });
                    closeModal('customerModal');
                    loadCustomers();
                    alert('Customer added successfully!');
                } catch (error) {
                    alert('Error adding customer: ' + error.message);
                }
            });
        }

        function showAddOrderModal() {
            const modal = `
                <div id="orderModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                    <div class="bg-white rounded-lg p-6 w-full max-w-md">
                        <h3 class="text-lg font-semibold mb-4">Add New Order</h3>
                        <form id="addOrderForm" class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Customer Email</label>
                                <input type="email" name="customerEmail" required class="w-full px-3 py-2 border border-gray-300 rounded-md">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Total Amount ($)</label>
                                <input type="number" name="total" step="0.01" required class="w-full px-3 py-2 border border-gray-300 rounded-md">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Status</label>
                                <select name="status" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                                    <option value="pending">Pending</option>
                                    <option value="completed">Completed</option>
                                    <option value="cancelled">Cancelled</option>
                                </select>
                            </div>
                            <div class="flex gap-2 pt-4">
                                <button type="submit" class="flex-1 btn-primary">Add Order</button>
                                <button type="button" onclick="closeModal('orderModal')" class="flex-1 px-4 py-2 border border-gray-300 rounded-lg">Cancel</button>
                            </div>
                        </form>
                    </div>
                </div>
            `;
            document.body.insertAdjacentHTML('beforeend', modal);
            
            document.getElementById('addOrderForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                const formData = new FormData(e.target);
                const orderData = Object.fromEntries(formData.entries());
                orderData.total = parseFloat(orderData.total);
                
                try {
                    await apiCall('/orders', {
                        method: 'POST',
                        body: JSON.stringify(orderData)
                    });
                    closeModal('orderModal');
                    loadOrders();
                    alert('Order added successfully!');
                } catch (error) {
                    alert('Error adding order: ' + error.message);
                }
            });
        }

        function showAddIntegrationModal() {
            const modal = `
                <div id="integrationModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                    <div class="bg-white rounded-lg p-6 w-full max-w-md">
                        <h3 class="text-lg font-semibold mb-4">Add Integration</h3>
                        <form id="addIntegrationForm" class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Platform</label>
                                <select name="platform" required class="w-full px-3 py-2 border border-gray-300 rounded-md">
                                    <option value="">Select Platform</option>
                                    <option value="shopify">Shopify</option>
                                    <option value="stripe">Stripe</option>
                                    <option value="mailchimp">Mailchimp</option>
                                    <option value="quickbooks">QuickBooks</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700">API Key</label>
                                <input type="text" name="apiKey" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Store URL</label>
                                <input type="url" name="storeUrl" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                            </div>
                            <div class="flex items-center">
                                <input type="checkbox" name="isActive" id="isActive" class="mr-2">
                                <label for="isActive" class="text-sm font-medium text-gray-700">Active Integration</label>
                            </div>
                            <div class="flex gap-2 pt-4">
                                <button type="submit" class="flex-1 btn-primary">Add Integration</button>
                                <button type="button" onclick="closeModal('integrationModal')" class="flex-1 px-4 py-2 border border-gray-300 rounded-lg">Cancel</button>
                            </div>
                        </form>
                    </div>
                </div>
            `;
            document.body.insertAdjacentHTML('beforeend', modal);
            
            document.getElementById('addIntegrationForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                const formData = new FormData(e.target);
                const integrationData = Object.fromEntries(formData.entries());
                integrationData.isActive = integrationData.isActive === 'on';
                
                try {
                    await apiCall('/integrations', {
                        method: 'POST',
                        body: JSON.stringify(integrationData)
                    });
                    closeModal('integrationModal');
                    loadIntegrations();
                    alert('Integration added successfully!');
                } catch (error) {
                    alert('Error adding integration: ' + error.message);
                }
            });
        }

        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.remove();
            }
        }

        // Initialize
        if (authToken && currentUser) {
            showMainApp();
            loadDashboard();
        } else {
            showLoginScreen();
        }
    </script>
</body>
</html> 